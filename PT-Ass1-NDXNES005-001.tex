% Options for packages loaded elsewhere
\PassOptionsToPackage{unicode}{hyperref}
\PassOptionsToPackage{hyphens}{url}
%
\documentclass[
  12pt,
]{article}
\usepackage{amsmath,amssymb}
\usepackage{iftex}
\ifPDFTeX
  \usepackage[T1]{fontenc}
  \usepackage[utf8]{inputenc}
  \usepackage{textcomp} % provide euro and other symbols
\else % if luatex or xetex
  \usepackage{unicode-math} % this also loads fontspec
  \defaultfontfeatures{Scale=MatchLowercase}
  \defaultfontfeatures[\rmfamily]{Ligatures=TeX,Scale=1}
\fi
\usepackage{lmodern}
\ifPDFTeX\else
  % xetex/luatex font selection
\fi
% Use upquote if available, for straight quotes in verbatim environments
\IfFileExists{upquote.sty}{\usepackage{upquote}}{}
\IfFileExists{microtype.sty}{% use microtype if available
  \usepackage[]{microtype}
  \UseMicrotypeSet[protrusion]{basicmath} % disable protrusion for tt fonts
}{}
\makeatletter
\@ifundefined{KOMAClassName}{% if non-KOMA class
  \IfFileExists{parskip.sty}{%
    \usepackage{parskip}
  }{% else
    \setlength{\parindent}{0pt}
    \setlength{\parskip}{6pt plus 2pt minus 1pt}}
}{% if KOMA class
  \KOMAoptions{parskip=half}}
\makeatother
\usepackage{xcolor}
\usepackage[margin=1in]{geometry}
\usepackage{graphicx}
\makeatletter
\def\maxwidth{\ifdim\Gin@nat@width>\linewidth\linewidth\else\Gin@nat@width\fi}
\def\maxheight{\ifdim\Gin@nat@height>\textheight\textheight\else\Gin@nat@height\fi}
\makeatother
% Scale images if necessary, so that they will not overflow the page
% margins by default, and it is still possible to overwrite the defaults
% using explicit options in \includegraphics[width, height, ...]{}
\setkeys{Gin}{width=\maxwidth,height=\maxheight,keepaspectratio}
% Set default figure placement to htbp
\makeatletter
\def\fps@figure{htbp}
\makeatother
\setlength{\emergencystretch}{3em} % prevent overfull lines
\providecommand{\tightlist}{%
  \setlength{\itemsep}{0pt}\setlength{\parskip}{0pt}}
\setcounter{secnumdepth}{-\maxdimen} % remove section numbering
% definitions for citeproc citations
\NewDocumentCommand\citeproctext{}{}
\NewDocumentCommand\citeproc{mm}{%
  \begingroup\def\citeproctext{#2}\cite{#1}\endgroup}
\makeatletter
 % allow citations to break across lines
 \let\@cite@ofmt\@firstofone
 % avoid brackets around text for \cite:
 \def\@biblabel#1{}
 \def\@cite#1#2{{#1\if@tempswa , #2\fi}}
\makeatother
\newlength{\cslhangindent}
\setlength{\cslhangindent}{1.5em}
\newlength{\csllabelwidth}
\setlength{\csllabelwidth}{3em}
\newenvironment{CSLReferences}[2] % #1 hanging-indent, #2 entry-spacing
 {\begin{list}{}{%
  \setlength{\itemindent}{0pt}
  \setlength{\leftmargin}{0pt}
  \setlength{\parsep}{0pt}
  % turn on hanging indent if param 1 is 1
  \ifodd #1
   \setlength{\leftmargin}{\cslhangindent}
   \setlength{\itemindent}{-1\cslhangindent}
  \fi
  % set entry spacing
  \setlength{\itemsep}{#2\baselineskip}}}
 {\end{list}}
\usepackage{calc}
\newcommand{\CSLBlock}[1]{\hfill\break\parbox[t]{\linewidth}{\strut\ignorespaces#1\strut}}
\newcommand{\CSLLeftMargin}[1]{\parbox[t]{\csllabelwidth}{\strut#1\strut}}
\newcommand{\CSLRightInline}[1]{\parbox[t]{\linewidth - \csllabelwidth}{\strut#1\strut}}
\newcommand{\CSLIndent}[1]{\hspace{\cslhangindent}#1}
\usepackage{setspace}
\onehalfspacing
\usepackage{etoolbox}
\apptocmd{\thebibliography}{\setlength{\itemsep}{1.0\baselineskip}}{}{}
\usepackage{amsmath}
\usepackage{amssymb}
\usepackage{float}
\usepackage{graphicx}
\usepackage{fvextra}
\usepackage{adjustbox}
\usepackage{tabu}
\usepackage{threeparttable}
\ifLuaTeX
  \usepackage{selnolig}  % disable illegal ligatures
\fi
\usepackage{bookmark}
\IfFileExists{xurl.sty}{\usepackage{xurl}}{} % add URL line breaks if available
\urlstyle{same}
\hypersetup{
  pdftitle={Portfolio Theory: Assignment 1},
  pdfauthor={Nesan Naidoo : NDXNES005},
  hidelinks,
  pdfcreator={LaTeX via pandoc}}

\title{Portfolio Theory: Assignment 1}
\usepackage{etoolbox}
\makeatletter
\providecommand{\subtitle}[1]{% add subtitle to \maketitle
  \apptocmd{\@title}{\par {\large #1 \par}}{}{}
}
\makeatother
\subtitle{The Statistics of Strategy Back-Testing}
\author{Nesan Naidoo : NDXNES005}
\date{2025-09-14}

\begin{document}
\maketitle

\section{Problem Specification}\label{problem-specification}

This assignment examined the statistics of strategy backtesting within
the context of portfolio theory. Part I focused on proving that the
estimated annualized Sharpe ratio(SR) converges asymptotically to a
normal distribution. Furthermore, part I motivated that for a
sufficiently large number of samples, the mean of the sample maximum of
standard normally distributed random variables can be approximated.
Lastly, part I focused on the derivation and discussion of the minimum
backtest length.

Part II focused on mean--variance backtesting of the tangency portfolio
under full investment and no-short-selling constraints. Sharpe
ratio--maximising portfolios are computed from rolling windows of the
historical data. The historical dataset is divided into in-sample (IS)
and out-of-sample (OOS) datasets. Two experiments are conducted: 1)
compared IS and OOS Sharpe ratios and 2) evaluated OOS backtest
performance using a rolling window approach.

\section{Data Specification}\label{data-specification}

The Tactical Asset Allocation data is from
PT-DATA-ALBI-JIBAR-JSEIND-Daily-1994-2017.xlsx

\begin{enumerate}
\def\labelenumi{\arabic{enumi}.}
\item
  ICB Industrial Level Indices
\item
  ALBI (All Bond Index (ALBI) Total Return Index (TRI) Data)
\item
  Money Market Data: JIBAR and STEFI TRI
\item
  Various Indices: JSE Growth, JSE Value, JSE ALSI, JSE SRI
\end{enumerate}

\section{Configuration control}\label{configuration-control}

Version control: managed with Git and GitHub.

Packages: managed with \texttt{renv} for reproducibility.

Project structure:

Repository:
\href{https://github.com/NesanNaidoo/Portfolio-Theory-Assignment-1-Backtesting}{github.com/NesanNaidoo/Portfolio-Theory-Assignment-1-Backtesting}

\section{PART I : Introduction to Strategy
Backtesting}\label{part-i-introduction-to-strategy-backtesting}

\subsection{Question 1 : Sample Error when Estimating the Sharpe
Ratio}\label{question-1-sample-error-when-estimating-the-sharpe-ratio}

Proof below based on asymptotic distributions of Sharpe Ratio estimators
(Lo 2002) (See Appendix A. IID Returns)

\subsection{Q1 --- Sample error when estimating the Sharpe
Ratio}\label{q1-sample-error-when-estimating-the-sharpe-ratio}

\subsubsection{Assumptions}\label{assumptions}

\begin{itemize}
\item
  We assume IID excess returns \(r_1,\dots,r_n\) with
  \(r_t \sim \mathcal{N}(\mu,\sigma^2).\)
\item
  Let \(q\) be returns per year, \(y\) the number of years, and
  \(n=qy\).
\item
  The true annualised Sharpe is \(SR=\sqrt{q}\,\frac{\mu}{\sigma}.\)
\item
  Estimators used in proof: \[
  \widehat\mu=\frac{1}{n}\sum_{t=1}^n r_t,\quad
  \widehat\sigma^2=\frac{1}{n}\sum_{t=1}^n (r_t-\widehat\mu)^2,\quad
  \widehat{SR}=\sqrt{q}\,\frac{\widehat\mu}{\widehat\sigma}.
  \]
\end{itemize}

\subsubsection{Distribution of the sample
mean}\label{distribution-of-the-sample-mean}

Since \(r_t\sim \mathcal{N}(\mu,\sigma^2)\) and using the fact the the
sum of independent Normal variables are Normal. Therefore,\[
\sum_{t=1}^n r_t \sim N\!\big(n\mu,\; n\sigma^2\big). \tag{1}
\]

Therefore, the sample mean \(\widehat\mu=\dfrac{1}{n}\sum_{t=1}^n r_t\)
follows a Normal distribution \[
\widehat\mu \sim N\!\Big(\mu,\; \frac{\sigma^2}{n}\Big). \tag{2}
\]

Hence, by centering and scaling by \(\sqrt{n}\) , this leads to \[
\sqrt{n}\,(\widehat\mu-\mu) \sim \mathcal{N}(0,\sigma^2). \tag{3}
\]

\subsubsection{Distribution of the sample
variance}\label{distribution-of-the-sample-variance}

Given
\(\widehat\sigma^2 \;=\; \frac{1}{n}\sum_{t=1}^n (r_t - \widehat\mu)^2\)
, then the result based on Normal theory is
\(\frac{n\widehat\sigma^2}{\sigma^2} \;\sim\; \chi^2_{\,n-1}.\)

If \(U \sim \chi^2_k\) then \(\mathbb{E}[U]=k\) and
\(\operatorname{Var}(U)=2k.\)

Hence, to standardise \(U\) we subtract its mean \(k\) and divide by its
standard deviation \(\sqrt{2k}\).\\
Let \(k=n-1\) and \(U = \dfrac{n\widehat\sigma^2}{\sigma^2}\) . Using
the fact that \(\chi_{n-1}^2\), is the sum of \(n-1\) independent
\(Z_i^2\) terms, where each \(Z_i^2\) has mean 1 and variance 2 and by
the Central Limit Theorem , the centered and scaled sum converges to
\(\mathcal{N}(0,1)\) as \(n \to \infty\). Therefore,

\[
\frac{\dfrac{n\widehat\sigma^2}{\sigma^2}-(n-1)}{\sqrt{2(n-1)}} \;\xrightarrow{d}\; \mathcal{N}(0,1), \qquad (n\to\infty)   \tag{4}.
\]

Next the numerator and denominator is multiplied by \(\sigma^2\): \[
\frac{n\widehat\sigma^2-(n-1)\sigma^2}{\sigma^2\sqrt{2(n-1)}} \xrightarrow{d} \mathcal{N}(0,1) \tag{5}.
\]

Then the numerator can be rewritten as
\(\mathcal{N}(\widehat\sigma^2-\sigma^2)+\sigma^2\) and fraction can be
split into 2 terms: \[
\frac{\mathcal{N}(\widehat\sigma^2-\sigma^2)}{\sigma^2\sqrt{2(n-1)}} + \frac{1}{\sqrt{2(n-1)}} \xrightarrow{d} \mathcal{N}(0,1) \tag{6}.
\] Since \(\dfrac{1}{\sqrt{2(n-1)}}\to 0\) as \(n\to\infty\), therefore
\[
\frac{\mathcal{N}(\widehat\sigma^2-\sigma^2)}{\sigma^2\sqrt{2(n-1)}} \xrightarrow{d} \mathcal{N}(0,1) \tag{7}.
\]

Let \(A_n=\sqrt{n}(\widehat\sigma^2-\sigma^2)\). Therefore, \[
\frac{\sqrt{n}\,A_n}{\sigma^2\sqrt{2(n-1)}} \xrightarrow{d} \mathcal{N}(0,1) \tag{8}.
\] Hence
\(A_n \xrightarrow{d} N\!\left(0,\frac{\sigma^4 2(n-1)}{n}\right)\), and
letting \(n\to\infty\) leads to \[
\sqrt{n}(\widehat\sigma^2-\sigma^2)\xrightarrow{d} \mathcal{N}(0,2\sigma^4) \tag{9}.
\]

\subsubsection{\texorpdfstring{Using Delta method to obtain
\(\sqrt{n}(\widehat\sigma-\sigma)\)}{Using Delta method to obtain \textbackslash sqrt\{n\}(\textbackslash widehat\textbackslash sigma-\textbackslash sigma)}}\label{using-delta-method-to-obtain-sqrtnwidehatsigma-sigma}

Let \(h(x)=\sqrt{x}\), so \(h'(\sigma^2)=1/(2\sigma)\). Then by Taylor
expansion, \[ 
\widehat\sigma-\sigma \approx h'(\sigma^2),(\widehat\sigma^2-\sigma^2)=1/(2\sigma)(\widehat\sigma^2-\sigma^2).
\] By multiplying by \(\sqrt{n}\) : \[ 
\sqrt{n}(\widehat\sigma-\sigma) \approx \frac{\sqrt{n}}{2\sigma}(\widehat\sigma^2-\sigma^2) 
\]

Using (9): \[
\sqrt{n}(\widehat\sigma-\sigma)\xrightarrow{d} N\!\Big(0,\Big(\frac{1}{2\sigma}\Big)^2\cdot 2\sigma^4\Big)=N\!\Big(0,\frac{\sigma^2}{2}\Big).
\]

\subsubsection{Combining results so far}\label{combining-results-so-far}

\[
\sqrt{n}\begin{pmatrix}\widehat\mu-\mu\\[4pt]\widehat\sigma-\sigma\end{pmatrix}
\xrightarrow{d} N\!\Big(0,\ \Sigma\Big)  \qquad\text{where}\qquad
\Sigma=\begin{pmatrix}\sigma^2 & 0\\[6pt]0 & \sigma^2/2\end{pmatrix}.
\]

\subsubsection{Using multivariate delta
method}\label{using-multivariate-delta-method}

Let \(g(\mu,\sigma)=\sqrt{q}\,\mu/\sigma = SR\) . Then the Taylor
expansion leads to \[
\sqrt{n}\big(g(\widehat\mu,\widehat\sigma)-g(\mu,\sigma)\big)
= \nabla g(\mu,\sigma)^\top \sqrt{n}\begin{pmatrix}\widehat\mu-\mu\\[4pt]\widehat\sigma-\sigma\end{pmatrix} + o_p(1).
\] Thus by the Central Limit Theorem, \[
\sqrt{n}(\widehat{SR}-SR)\xrightarrow{d} N\!\Big(0,\nabla g^\top\Sigma\nabla g\Big).
\]

\subsubsection{Calculating the gradient and
variance}\label{calculating-the-gradient-and-variance}

Partial derivatives: \[
\frac{\partial g}{\partial\mu}=\frac{\sqrt{q}}{\sigma} \qquad \text{and} \qquad
\frac{\partial g}{\partial\sigma}=-\frac{SR}{\sigma},
\] so \(\nabla g=(\sqrt{q}/\sigma,\ -SR/\sigma)^\top\). Then \[
V=\nabla g^\top\Sigma\nabla g
= \Big(\frac{\sqrt{q}}{\sigma}\Big)^2\sigma^2 + \Big(\frac{SR}{\sigma}\Big)^2\frac{\sigma^2}{2}
= q + \frac{SR^2}{2}.
\] Hence, \[
\sqrt{n}(\widehat{SR}-SR)\xrightarrow{d} N\!\Big(0,\; q+\frac{SR^2}{2}\Big).
\]

\subsubsection{Converting to variance per
year}\label{converting-to-variance-per-year}

Therefore,\[
\operatorname{Var}(\widehat{SR})\approx\frac{q+\tfrac{SR^2}{2}}{n}.
\] By dividing numerator and denominator by \(q\): \[
\frac{q+\tfrac{SR^2}{2}}{n}=\frac{1+\tfrac{SR^2}{2q}}{\,n/q\,}= \frac{1+\tfrac{SR^2}{2q}}{y}.
\] Since \(n/q=y\). Thus the final result is \[
\widehat{SR}\xrightarrow{d} N\!\Big(SR,\ \frac{1+\tfrac{SR^2}{2q}}{y}\Big).
\]

\subsection{Question 2 : The Maximum of the
Sample}\label{question-2-the-maximum-of-the-sample}

Proof below based on (D. H. Bailey and López de Prado 2014) (See
Appendix: Proof of proposition 1) ,(Embrechts, Klüppelberg, and Mikosch
1997) (pp.138--147) and (Resnick 2008) (see Proposition 2.1(iii))

\subsection{Question 3 : Minimum Backtest
Length}\label{question-3-minimum-backtest-length}

\section{PART II : Backtest Performance of the Tangency
Portfolio}\label{part-ii-backtest-performance-of-the-tangency-portfolio}

\subsection{Experiment 1 : In-Sample and Out-Of-Sample Sharpe
Ratios}\label{experiment-1-in-sample-and-out-of-sample-sharpe-ratios}

\subsection{Experiment 2 : Out-Of-Sample Backtesting using a Rolling
Window}\label{experiment-2-out-of-sample-backtesting-using-a-rolling-window}

\newpage

\section{References}\label{references}

\phantomsection\label{refs}
\begin{CSLReferences}{1}{0}
\bibitem[\citeproctext]{ref-bailey_2014}
Bailey, David H., and Marcos López de Prado. 2014. {``The Deflated
Sharpe Ratio:correcting for Selection Bias, BacktestOverfitting, and
Non-Normality.''} \emph{The Journal of Portfolio Management} 40
(September): 94--107. \url{https://doi.org/10.3905/jpm.2014.40.5.094}.

\bibitem[\citeproctext]{ref-bailey_2016}
Bailey, David, Jonathan Borwein, Marcos López de Prado, and Qiji Jim
Zhu. 2016. {``The Probability of Backtest Overfitting.''} \emph{The
Journal of Computational Finance}, September.
\url{https://doi.org/10.21314/jcf.2016.322}.

\bibitem[\citeproctext]{ref-embrechts_1997}
Embrechts, Paul, Claudia Klüppelberg, and Thomas Mikosch. 1997.
\emph{Modelling Extremal Events for Insurance and Finance}. Springer.

\bibitem[\citeproctext]{ref-lee_2000}
Lee, Wai. 2000. \emph{Theory and Methodology of Tactical Asset
Allocation}. John Wiley \& Sons.

\bibitem[\citeproctext]{ref-liu_2012}
Liu, Ying, Marie Rekkas, and Augustine Wong. 2012. {``Inference for the
Sharpe Ratio Using a Likelihood-Based Approach.''} \emph{Journal of
Probability and Statistics} 2012: 1--24.
\url{https://doi.org/10.1155/2012/878561}.

\bibitem[\citeproctext]{ref-lo_2002}
Lo, Andrew W. 2002. {``The Statistics of Sharpe Ratios.''}
\emph{Financial Analysts Journal} 58 (July): 36--52.
\url{https://doi.org/10.2469/faj.v58.n4.2453}.

\bibitem[\citeproctext]{ref-resnick_2008}
Resnick, Sidney I. 2008. \emph{Extreme Values, Regular Variation and
Point Processes}. Springer, Cop.

\end{CSLReferences}

\newpage

\section{Appendix A : Code}\label{appendix-a-code}

\section{Appendix B : Session
Information}\label{appendix-b-session-information}

\end{document}
